<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>sequential-migrate</title><meta name="description" content="Documentation for sequential-migrate"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">sequential-migrate</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>sequential-migrate</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#sequential-migrate" id="sequential-migrate" style="color: inherit; text-decoration: none;">
  <h1>Sequential migrate</h1>
</a>
<p>A database migration tool written in Node.js. <code>sequential-migrate</code> is unopinionated about your database of choice, format of migration files and how it knows which migrations have been run, but still does the heavy lifting in organising your migrations. It does this by exposing files with clear, statically typed interfaces which it uses to manage your migrations as a stack. </p>
<p>It has 0 dependencies and <a href="./docs/modules.md">good documentation</a>. You can use it via the command line or by importing functions in your scripts. PRs are welcome!</p>
<p>Note that links in this readme work on GitHub but not on npmjs.com.</p>
<ul>
<li><a href="#sequential-migrate">Sequential migrate</a><ul>
<li><a href="#the-package-at-a-glance">The package at a glance</a></li>
<li><a href="#getting-started">Getting started</a><ul>
<li><a href="#command-line-api">Command line API</a></li>
<li><a href="#programmatic-api">Programmatic API</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<a href="#the-package-at-a-glance" id="the-package-at-a-glance" style="color: inherit; text-decoration: none;">
  <h2>The package at a glance</h2>
</a>
<p>sequential-migrate analyses the state of your migrations by comparing two things. Firstly, it reads the contents of your <code>migrations</code> folder. Each folder or file inside <code>migrations</code> represents one migration, and should export an object with the <a href="./docs/interfaces/MigrationScript.md">MigrationScript</a> interface.</p>
<p>The package compares the contents of the <code>migrations</code> folder with a stored history of migrations. It does this by using the <code>stateInterface</code>, a script you should write that exports an object with the <a href="./docs/interfaces/StateScript.md">StateScript</a> interface.</p>
<p>By comparing the migration scripts with the stored states, the sequential-migrate CLI can assign a <a href="./docs/enums/MIGRATION_STATUS.md">status</a> to the scripts.</p>
<p>When you run <code>up</code> or <code>down</code>, the program iterates through the list of scripts. For each script, it calls the <code>up</code> or <code>down</code> function from the <code>MigrationScript</code>, and then it tells the <code>stateInterface</code> about the change by calling <a href="./docs/interfaces/StateScript.md#add">StateScript.add</a> or <a href="./docs/interfaces/StateScript.md#remove">StateScript.remove</a>.</p>
<p>It treats the set of migrations derived by combining the migration files with the stored state as a stack - that is, it only adds to or removes the most recent item. It encourages you to order migrations by the time they&#39;re released, rather than the time they&#39;re fixed, and in development to always run migrations in order, even if that means rolling back and then forward again.</p>

<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
  <h2>Getting started</h2>
</a>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">i</span><span class="hl-1"> -</span><span class="hl-2">D</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span>
</code></pre>
<p>or</p>
<pre><code><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-0">add</span><span class="hl-1"> --</span><span class="hl-0">save</span><span class="hl-1">-</span><span class="hl-0">dev</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span>
</code></pre>
<p>Add this to your <code>package.json</code>&#39;s <code>scripts</code> section:</p>
<p>Run the <a href="./docs/enums/COMMAND.md#scaffold">scaffold</a> command with </p>
<pre><code><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span><span class="hl-1"> </span><span class="hl-0">scaffold</span>
</code></pre>
<p>From here you have two options, either use the package from the command line, or import functions into your Node scripts:</p>

<a href="#command-line-api" id="command-line-api" style="color: inherit; text-decoration: none;">
  <h3>Command line API</h3>
</a>
<p>Create a migration with:</p>
<pre><code><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">my</span><span class="hl-1">-</span><span class="hl-0">first</span><span class="hl-1">-</span><span class="hl-0">migration</span>
</code></pre>
<p>Check your migrations with:</p>
<pre><code><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span><span class="hl-1"> </span><span class="hl-0">status</span>
</code></pre>
<p>Run all pending migrations:</p>
<pre><code><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1"> </span><span class="hl-0">migrate</span><span class="hl-1"> </span><span class="hl-0">up</span>
</code></pre>
<p>Run all pending migrations up to and including <code>1641903774203-my-cool-feature</code>:</p>
<pre><code><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span><span class="hl-1"> </span><span class="hl-0">up</span><span class="hl-1"> </span><span class="hl-4">1641903774203</span><span class="hl-1">-</span><span class="hl-0">my</span><span class="hl-1">-</span><span class="hl-0">cool</span><span class="hl-1">-</span><span class="hl-0">feature</span>
</code></pre>
<p><code>sequential-migrate down</code> works the same as <code>sequential-migrate up</code> except that if you run down to a migration, that migration is not rolled back, only those that come after it are. </p>
<p>Check whether your migration state is OK in a machine-friendly way:</p>
<pre><code><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-0">sequential</span><span class="hl-1">-</span><span class="hl-0">migrate</span><span class="hl-1"> </span><span class="hl-0">ci</span><span class="hl-1">-</span><span class="hl-0">check</span>
</code></pre>
<p>For more details on all of these commands, please see <a href="./docs/enums/COMMAND.md">the docs</a>.</p>

<a href="#programmatic-api" id="programmatic-api" style="color: inherit; text-decoration: none;">
  <h3>Programmatic API</h3>
</a>
<p>Here&#39;s a sample script</p>
<pre><code class="language-javascript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-0">getStatus</span><span class="hl-1">, </span><span class="hl-0">up</span><span class="hl-1">, </span><span class="hl-0">down</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-6">&quot;sequential-migrate&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">main</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-2">state</span><span class="hl-1">, </span><span class="hl-2">containsMissing</span><span class="hl-1">, </span><span class="hl-2">containsSkipped</span><span class="hl-1"> } = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-7">getStatus</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-0">containsMissing</span><span class="hl-1"> || </span><span class="hl-0">containsSKipped</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-8">Error</span><span class="hl-1">(</span><span class="hl-6">&quot;Please check migration state manually&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-9">// migrate to the penultimate migration for no reason, just to demonstrate how up function works</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-2">penultimateMigration</span><span class="hl-1"> = </span><span class="hl-0">state</span><span class="hl-1">[</span><span class="hl-0">state</span><span class="hl-1">.</span><span class="hl-0">length</span><span class="hl-1"> - </span><span class="hl-4">2</span><span class="hl-1">]</span><br/><span class="hl-1">  </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-7">up</span><span class="hl-1">(</span><span class="hl-0">penultimateMigration</span><span class="hl-1">.</span><span class="hl-0">name</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">main</span><span class="hl-1">()</span>
</code></pre>
<p>For documentation for these functions, please refer to the <a href="./docs/modules">exports</a> section of the docs.</p>
<p>Certain functionality, like scaffolding the project or creating new migration scripts, is limited to the command-line API - but if you have a usecase for exposing these features in JavaScript, let me know and I can add them.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/COMMAND.html" class="tsd-kind-icon">COMMAND</a></li><li class="tsd-kind-enum"><a href="enums/EXIT_MESSAGE.html" class="tsd-kind-icon">EXIT_<wbr/>MESSAGE</a></li><li class="tsd-kind-enum"><a href="enums/MIGRATION_STATUS.html" class="tsd-kind-icon">MIGRATION_<wbr/>STATUS</a></li><li class="tsd-kind-interface"><a href="interfaces/InferredStateItem.html" class="tsd-kind-icon">Inferred<wbr/>State<wbr/>Item</a></li><li class="tsd-kind-interface"><a href="interfaces/MigrationBuilder.html" class="tsd-kind-icon">Migration<wbr/>Builder</a></li><li class="tsd-kind-interface"><a href="interfaces/MigrationScript.html" class="tsd-kind-icon">Migration<wbr/>Script</a></li><li class="tsd-kind-interface"><a href="interfaces/RecordedStateItem.html" class="tsd-kind-icon">Recorded<wbr/>State<wbr/>Item</a></li><li class="tsd-kind-interface"><a href="interfaces/RuntimeConfiguration.html" class="tsd-kind-icon">Runtime<wbr/>Configuration</a></li><li class="tsd-kind-interface"><a href="interfaces/StateScript.html" class="tsd-kind-icon">State<wbr/>Script</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ConfigurationFile" class="tsd-kind-icon">Configuration<wbr/>File</a></li><li class="tsd-kind-type-alias"><a href="modules.html#InferredState" class="tsd-kind-icon">Inferred<wbr/>State</a></li><li class="tsd-kind-type-alias"><a href="modules.html#RecordedState" class="tsd-kind-icon">Recorded<wbr/>State</a></li><li class="tsd-kind-type-alias"><a href="modules.html#down" class="tsd-kind-icon">down</a></li><li class="tsd-kind-type-alias"><a href="modules.html#getStatus" class="tsd-kind-icon">get<wbr/>Status</a></li><li class="tsd-kind-type-alias"><a href="modules.html#up" class="tsd-kind-icon">up</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>